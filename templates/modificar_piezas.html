{% extends "base_template.html" %}

{% block titulo %}
Modificar Habitaciones
{% endblock %}

{% block content %}
{% if current_user.is_authenticated and current_user.es_admin() %}
<form method="POST" enctype="multipart/form-data">
    <label>Nombre de la pieza:</label>
    <input type="text" name="nombre_pieza" value="{{ pieza.nombre_pieza }}" required>

    <label>Descripción:</label>
    <textarea name="descripcion_pieza" required>{{ pieza.descripcion_pieza }}</textarea>

    <label>Cantidad de personas:</label>
    <input type="number" name="cantidad_personas" value="{{ pieza.cantidad_personas }}" required>

    <label>Precio:</label>
    <input type="text" id="precio_pieza" name="precio_pieza" value="{{ pieza.precio_pieza }}" required>

    <label>Descuento (%):</label>
    <input type="number" id="descuento" name="descuento" value="{{ pieza.descuento }}" required>

    <p>Precio final: 
        <span id="precio_final">
            {{ pieza.precio_pieza - (pieza.precio_pieza * pieza.descuento / 100) | round(2) }}
        </span>
    </p>

    <label>Imágenes actuales:</label>
    {% for img in pieza.imagen_pieza.split(',') %}
        <img src="{{ url_for('static', filename='imagenes/' ~ img) }}" alt="Imagen" style="width:100px;">
    {% endfor %}

    <label>Subir nuevas imágenes:</label>
    <input type="file" name="imagenes_pieza" multiple>

    <button type="submit">Guardar cambios</button>
    <button type="submit" name="eliminar" value="eliminar">Eliminar habitación</button>
</form>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const precioInput = document.getElementById('precio_pieza');
        const descuentoInput = document.getElementById('descuento');
        const precioFinal = document.getElementById('precio_final');

        function actualizarPrecioFinal() {
            const precio = parseFloat(precioInput.value) || 0;
            const descuento = parseFloat(descuentoInput.value) || 0;
            const precioConDescuento = precio - (precio * descuento / 100);
            precioFinal.textContent = precioConDescuento.toFixed(2);
        }

        precioInput.addEventListener('input', actualizarPrecioFinal);
        descuentoInput.addEventListener('input', actualizarPrecioFinal);
    });
</script>

{% else %}
    <p>No tienes permiso para acceder a esta página.</p>
{% endif %}
{% endblock %}
